#include "fonts.h"

/* --- utilidades --- */
static char to_upper(char c){ return (c>='a' && c<='z') ? (char)(c-32) : c; }

static const FontScriptGlyph GLYPHS[] = {
    /* espacio y signos básicos */
    {' ', 2, {0x0000,0x0000}},
    {'!', 2, {0x7E00,0x7E00}},
    {'.', 2, {0x0000,0x6000}},
    {',', 2, {0x2000,0x6000}},
    {'-', 4, {0x0180,0x0180,0x0180,0x0180}},
    {':', 2, {0x0660,0x0660}},
    {'?', 7, {0x0018,0x000C,0x6106,0x6306,0x030C,0x01F8,0x00F0}},

    /* Dígitos 0–9 (9 columnas salvo '1' y 'J' más estrechos) */
    {'0',9,{0x07E0,0x1FF8,0x3C1C,0x700E,0x6006,0x700E,0x3C1C,0x1FF8,0x07E0}},
    {'1',6,{0x0018,0x003C,0x7FFE,0x7FFE,0x0000,0x0000}},
    {'2',9,{0x1830,0x3C38,0x7E1C,0x671C,0x638E,0x61CE,0x60FC,0x6078,0x6030}},
    {'3',9,{0x1818,0x383C,0x707E,0x6066,0x6066,0x70E6,0x3DFC,0x1DF8,0x0C70}},
    {'4',9,{0x01C0,0x03E0,0x0670,0x0C38,0x183C,0x7FFE,0x7FFE,0x0000,0x0000}},
    {'5',9,{0x607E,0x607E,0x6066,0x6066,0x6066,0x70E6,0x3DFC,0x1DF8,0x0C70}},
    {'6',9,{0x07F0,0x1FF8,0x39DC,0x70CE,0x60C6,0x70C6,0x39CE,0x1F9C,0x0F18}},
    {'7',9,{0x6000,0x7000,0x7C3E,0x1FFE,0x03E0,0x00F0,0x0078,0x0038,0x0018}},
    {'8',9,{0x0F78,0x1FFC,0x39CE,0x70C6,0x60C6,0x70C6,0x39CE,0x1FFC,0x0F78}},
    {'9',9,{0x1878,0x39FC,0x73CE,0xE1C6,0xC1C6,0xE1C6,0x73CE,0x3FFC,0x1FF8}},

    /* A–Z */
    {'A',9,{0x01F0,0x07FC,0x1E1E,0x3837,0x7033,0x3837,0x1E1E,0x07FC,0x01F0}},
    {'B',9,{0x7FFE,0x7FFE,0x60C6,0x60C6,0x60C6,0x70EE,0x3DFC,0x1DF8,0x0C70}},
    {'C',8,{0x07F8,0x1FFE,0x3C0F,0x7003,0x6003,0x7003,0x381F,0x183E}},
    {'D',9,{0x7FFE,0x7FFE,0x6006,0x6006,0x700E,0x3C1C,0x1FF8,0x0FF0,0x0000}},
    {'E',8,{0x7FFE,0x7FFE,0x6066,0x6066,0x6066,0x6066,0x6066,0x6006}},
    {'F',8,{0x7FFE,0x7FFE,0x0066,0x0066,0x0066,0x0066,0x0006,0x0006}},
    {'G',9,{0x07F8,0x1FFE,0x3C06,0x7006,0x61C6,0x71C6,0x3FCE,0x1FDC,0x0798}},
    {'H',9,{0x7FFE,0x7FFE,0x0060,0x0060,0x0060,0x0060,0x7FFE,0x7FFE,0x0000}},
    {'I',5,{0x6006,0x7FFE,0x7FFE,0x6006,0x0000}},
    {'J',7,{0x1800,0x3800,0x7006,0x6006,0x7FFE,0x3FFE,0x0000}},
    {'K',9,{0x7FFE,0x7FFE,0x00E0,0x03F0,0x0F1C,0x3C0E,0x7006,0x6002,0x0000}},
    {'L',7,{0x7FFE,0x7FFE,0x6000,0x6000,0x6000,0x6000,0x6000}},
    {'M',11,{0x7FFE,0x7FFE,0x003C,0x00F0,0x03C0,0x03C0,0x00F0,0x003C,0x7FFE,0x7FFE,0x0000}},
    {'N',10,{0x7FFE,0x7FFE,0x001E,0x0078,0x01E0,0x0780,0x1E00,0x7FFE,0x7FFE,0x0000}},
    {'O',9,{0x07F8,0x1FFE,0x3C0F,0x7007,0x6003,0x7007,0x3C0F,0x1FFE,0x07F8}},
    {'P',9,{0x7FFE,0x7FFE,0x00C6,0x00C6,0x00C6,0x00EE,0x007C,0x0038,0x0000}},
    {'Q',9,{0x07F8,0x1FFE,0x3C0F,0x7007,0x6403,0x7C07,0x3E0F,0x3FFE,0x27F8}},
    {'R',9,{0x7FFE,0x7FFE,0x00C6,0x01C6,0x07C6,0x1E6E,0x383C,0x7000,0x6000}},
    {'S',9,{0x20F8,0x61FC,0x638E,0x6306,0x6306,0x7386,0x3F9C,0x1F18,0x0E00}},
    {'T',9,{0x0006,0x0006,0x7FFE,0x7FFE,0x0006,0x0006,0x0006,0x0000,0x0000}},
    {'U',9,{0x3FFE,0x7FFE,0x6000,0x6000,0x6000,0x6000,0x7FFE,0x3FFE,0x0000}},
    {'V',9,{0x003E,0x01FE,0x07E0,0x1F00,0x7800,0x1F00,0x07E0,0x01FE,0x003E}},
    {'W',11,{0x03FE,0x1FFE,0x7C00,0x1F80,0x03F0,0x03F0,0x1F80,0x7C00,0x1FFE,0x03FE,0x0000}},
    {'X',9,{0x6006,0x381C,0x1E78,0x07E0,0x03C0,0x07E0,0x1E78,0x381C,0x6006}},
    {'Y',9,{0x000E,0x003E,0x00F8,0x7FE0,0x7FE0,0x00F8,0x003E,0x000E,0x0000}},
    {'Z',9,{0x7006,0x7806,0x7E06,0x6786,0x61E6,0x60FE,0x607E,0x603E,0x601E}},

    /* ——— minúsculas con glifo propio “script” ——— */
    {'a',9,{0x00F0,0x01F8,0x0398,0x0318,0x0318,0x0398,0x03F8,0x07F0,0x0600}},
    {'e',9,{0x01F0,0x03F8,0x0638,0x0618,0x07F8,0x07F8,0x0618,0x0638,0x0010}},
    {'l',9,{0x0000,0x0000,0x7FF8,0x7FF8,0x0008,0x000C,0x000C,0x0008,0x0000}},
    {'o',9,{0x01F0,0x03F8,0x063C,0x061C,0x061C,0x063C,0x03F8,0x01F0,0x0000}},

};


static const struct { char lc, uc; } LC_ALIAS[] = {
    {'b','B'},{'c','C'},{'d','D'},{'f','F'},{'g','G'},{'h','H'},
    {'i','I'},{'j','J'},{'k','K'},{'m','M'},{'n','N'},{'p','P'},
    {'q','Q'},{'r','R'},{'s','S'},{'t','T'},{'u','U'},{'v','V'},
    {'w','W'},{'x','X'},{'y','Y'},{'z','Z'}
};

/* =========================== API =========================== */
const FontScriptGlyph* fontscript_find(char c)
{
    /* Buscar coincidencia exacta */
    for (unsigned i = 0; i < sizeof(GLYPHS)/sizeof(GLYPHS[0]); ++i)
        if (GLYPHS[i].ch == c) return &GLYPHS[i];

    /* Si es minúscula y no hay trazo propio, mapea la MAYÚSCULA */
    if (c >= 'a' && c <= 'z') {
        for (unsigned k=0; k<sizeof(LC_ALIAS)/sizeof(LC_ALIAS[0]); ++k)
            if (LC_ALIAS[k].lc == c) {
                char U = LC_ALIAS[k].uc;
                for (unsigned i = 0; i < sizeof(GLYPHS)/sizeof(GLYPHS[0]); ++i)
                    if (GLYPHS[i].ch == U) return &GLYPHS[i];
                break;
            }
        /* ASCII a MAYÚSCULA y busca */
        char U = to_upper(c);
        for (unsigned i = 0; i < sizeof(GLYPHS)/sizeof(GLYPHS[0]); ++i)
            if (GLYPHS[i].ch == U) return &GLYPHS[i];
    }

    /* '?' si no se encuentra */
    for (unsigned i = 0; i < sizeof(GLYPHS)/sizeof(GLYPHS[0]); ++i)
        if (GLYPHS[i].ch == '?') return &GLYPHS[i];

    /* espacio */
    return &GLYPHS[0];
}
